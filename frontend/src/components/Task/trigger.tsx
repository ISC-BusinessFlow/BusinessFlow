import { observer } from 'mobx-react-lite';
import { useRef } from 'react';

import { useRegisterNode } from '@/diagrams';
import { Task as TaskType } from '@/lib/Task';

import { DisplayText } from './displaytext';

const size = {
  width: 125,
  height: 50,
};

export const Trigger: React.VFC<{ task: TaskType }> = observer(({ task }) => {
  const taskRef = useRef<SVGRectElement>(null);
  useRegisterNode(taskRef, task.id);
  const trans = `translate(${task.x}, ${task.y})`;

  return (
    <>
      <g transform={trans}>
        <mask id="path-1-inside-1_6_60" fill="white">
          <path
            fillRule="evenodd"
            clipRule="evenodd"
            d="M12.5 50C12.6675 50 12.8341 49.9934 13 49.9804V50H112.5H113V49.9804C119.672 49.4555 125 38.4722 125 25C125 11.5278 119.672 0.544538 113 0.0196345V0H112.5H13V0.0196345C12.8341 0.00658564 12.6675 0 12.5 0C5.59644 0 0 11.1929 0 25C0 38.8071 5.59644 50 12.5 50Z"
          />
        </mask>
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M12.5 50C12.6675 50 12.8341 49.9934 13 49.9804V50H112.5H113V49.9804C119.672 49.4555 125 38.4722 125 25C125 11.5278 119.672 0.544538 113 0.0196345V0H112.5H13V0.0196345C12.8341 0.00658564 12.6675 0 12.5 0C5.59644 0 0 11.1929 0 25C0 38.8071 5.59644 50 12.5 50Z"
          fill="#598CD8"
        />
        <path
          d="M13 49.9804H15V47.8168L12.8431 47.9865L13 49.9804ZM13 50H11V52H13V50ZM113 50V52H115V50H113ZM113 49.9804L112.843 47.9865L111 48.1315V49.9804H113ZM113 0.0196345H111V1.86846L112.843 2.01347L113 0.0196345ZM113 0H115V-2H113V0ZM13 0V-2H11V0H13ZM13 0.0196345L12.8431 2.01347L15 2.18317V0.0196345H13ZM12.8431 47.9865C12.7293 47.9955 12.615 48 12.5 48V52C12.7199 52 12.939 51.9914 13.1569 51.9742L12.8431 47.9865ZM15 50V49.9804H11V50H15ZM112.5 48H13V52H112.5V48ZM113 48H112.5V52H113V48ZM111 49.9804V50H115V49.9804H111ZM123 25C123 31.4969 121.711 37.303 119.7 41.4773C117.634 45.7664 115.093 47.8095 112.843 47.9865L113.157 51.9742C117.579 51.6263 121.038 47.9153 123.304 43.2136C125.624 38.3969 127 31.9753 127 25H123ZM112.843 2.01347C115.093 2.19049 117.634 4.23357 119.7 8.52272C121.711 12.697 123 18.5031 123 25H127C127 18.0247 125.624 11.6031 123.304 6.78644C121.038 2.08468 117.579 -1.62632 113.157 -1.9742L112.843 2.01347ZM111 0V0.0196345H115V0H111ZM112.5 2H113V-2H112.5V2ZM13 2H112.5V-2H13V2ZM15 0.0196345V0H11V0.0196345H15ZM12.5 2C12.615 2 12.7293 2.00452 12.8431 2.01347L13.1569 -1.9742C12.939 -1.99135 12.7199 -2 12.5 -2V2ZM2 25C2 18.3396 3.35408 12.4086 5.45002 8.21676C7.60577 3.90526 10.2139 2 12.5 2V-2C7.88256 -2 4.24067 1.69118 1.87231 6.4279C-0.555863 11.2843 -2 17.8533 -2 25H2ZM12.5 48C10.2139 48 7.60577 46.0947 5.45002 41.7832C3.35408 37.5914 2 31.6604 2 25H-2C-2 32.1467 -0.555863 38.7157 1.87231 43.5721C4.24067 48.3088 7.88256 52 12.5 52V48Z"
          fill="#40669E"
          mask="url(#path-1-inside-1_6_60)"
        />
      </g>
      <DisplayText task={task} width={size.width} height={size.height} />
    </>
  );
});
